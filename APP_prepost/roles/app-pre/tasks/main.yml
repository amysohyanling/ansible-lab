---
# tasks file for app-pre
- name: Gather service facts
  ansible.builtin.service_facts:

- name: Check running services for JBoss and WildFly
  ansible.builtin.set_fact:
    jboss_service_status: "{{ ansible_facts['services']['jboss-eap.service']['state'] }}"
    wildfly_service_status: "{{ ansible_facts['services']['jboss-wildfly.service']['state'] }}"

#- name: Print services that are running
#  ansible.builtin.debug:
#    msg: "{{ item }} is running "
#  loop:
#    - jboss_service_status
#    - wildfly_service_status

- name: stop jboss and wildfly services
  ansible.builtin.service:
    name: "{{ item }}"
    state: stopped
  loop:
    - jboss-eap
    - jboss-wildfly 

- name: Check wildfly and jboss services has stopped
  ansible.builtin.service_facts:
  failed_when: ansible_facts['services']['jboss-wildfly.service']['state'] == "running" or ansible_facts['services']['jboss-eap.service']['state'] == "running"


